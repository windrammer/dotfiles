---
- name: run playbook on localhost
  hosts: 127.0.0.1
  connection: local
  ignore_errors: yes
  become: no

  pre_tasks:
    - name: Check if homebrew is installed
      stat:
        path: /opt/homebrew/bin/brew
      register: homebrew_check

    - name: Install homebrew
      shell: /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
      when:
        - not homebrew_check.stat.exists

    - name: Check if oh-my-zsh is installed
      stat:
        path: ~/.oh-my-zsh
      register: oh-my-zsh_check

    - name: Install oh-my-zsh
      shell: sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
      when:
        - not oh-my-zsh_check.stat.exists

  tasks:

  # - name: install stuff from brewfile

  - name: run link script
    shell: /Users/david.tollman/dotfiles/mac/./link.sh

  - name: ensure zsh is standard shell
    shell: dscl . -read /Users/$USER UserShell

  #  Can be removed when new oh my zsh stuff is implemented but kept around for posterity
  # - name: Check if .oh-my-zsh exists
  #   stat:
  #     path: ~/.oh-my-zsh
  #   register: stat_oh_my_zsh_result

  # - name: cloning oh-my-zsh
  #   git:
  #     repo=https://github.com/robbyrussell/oh-my-zsh
  #     dest=~/.oh-my-zsh
  #   when: not stat_oh_my_zsh_result.stat.exists

  - name: cloning zsh-autosuggestions
    git:
      repo=https://github.com/zsh-users/zsh-autosuggestions
      dest=~/.oh-my-zsh/custom/plugins/zsh-autosuggestions

  - name: cloning zsh-syntax-highlighting
    git:
      repo=https://github.com/zsh-users/zsh-syntax-highlighting
      dest=~/.oh-my-zsh/custom//plugins/zsh-syntax-highlighting

  - name: cloning p10k
    git:
      repo=https://github.com/romkatv/powerlevel10k.git
      dest=~/powerlevel10k

  # - name: set git fucked alias
  #   git_config:
  #     name: alias.fucked
  #     value: reset --hard HEAD

  # Remove after brewfile install is fixed
  - name: install rectangle
    homebrew:
      name: rectangle
      state: present

  # Remove after brewfile install is fixed
  - name: install bat
    homebrew:
      name: bat
      state: present

  # no idea here, investigate
  - name: install terraform
    homebrew:
      name: terraform
      state: present

  # Remove after brewfile install is fixed
  - name: install kubectl
    homebrew:
      name: kubectl
      state: present

  # Remove after brewfile install is fixed
  - name: install kubectx
    homebrew:
      name: kubectx
      state: present

  # Remove after brewfile install is fixed
  - name: install helm
    homebrew:
      name: helm
      state: present

  # Remove after brewfile install is fixed
  - name: install jq
    homebrew:
      name: jq
      state: present

  # Remove after brewfile install is fixed
  - name: install kustomize
    homebrew:
      name: kustomize
      state: present

  # Remove after brewfile install is fixed
  - name: install yq
    homebrew:
      name: yq
      state: present

  # Remove after brewfile install is fixed
  - name: install commitizen
    homebrew:
      name: commitizen
      state: present
