#!/usr/bin/env sh

# Commit Guard - Conventional commit validation with wip bypass
# Validates commit messages using commitlint

# Skip validation for wip: commits (fast path, no Node needed)
if grep -qE '^wip:' "$1"; then
  echo "â­ï¸  Skipping validation for wip commit"
  exit 0
fi

# Run commitlint
# Looks for config in: repo root, then home directory
if command -v npx >/dev/null 2>&1; then
  if ! npx --no -- commitlint --edit "$1"; then
    echo ""
    echo "âŒ Commit message validation failed!"
    echo ""
    echo "Expected format: type(scope): subject"
    echo "Examples: feat: add new feature"
    echo "          fix(auth): resolve login bug"
    echo ""
    echo "Valid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert, wip"
    echo ""
    echo "ğŸ’¡ To fix: git commit --amend"
    echo "ğŸ’¡ To bypass: prefix message with 'wip:'"
    echo ""
    exit 1
  fi
else
  echo "âš ï¸  npx not found, skipping commitlint validation"
  exit 0
fi

printf '\n\033[0;32mâœ… Commit made successfully.\033[0m\n\n'
